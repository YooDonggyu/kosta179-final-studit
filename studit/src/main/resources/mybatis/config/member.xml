<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">
	
	<!-- 
		이메일을 통한 회원 객체 검색.
		@author 유동규
		@param memberEmail 검색할 이메일
		@return memberVO 해당 이메일에 대해 값이 있으면 객체를 반환. 없으면 null
	 -->
	<select id="findMemberByEmail" resultType="memberVO">
		select member_email,password, addr, phone, regdate, name, password_hint,password_answer,pic_path 
		from member 
		where member_email = #{value}
	</select>

    <!-- 
    	회원가입 시 입력된 데이터를 member DB에 insert한다.
    	@author 변태섭
    	@param memberVO
     -->
	<insert id="registerMember" parameterType="memberVO">
		insert into member(member_email,password,name,addr,phone,regdate,password_hint,password_answer,pic_path)
		values(#{memberEmail},#{password},#{name},#{addr},#{phone},sysdate,#{passwordHint},#{passwordAnswer},#{picPath})
	</insert>
	
	<!-- 
		@author 김유란, 이승수
		@param memberVO
		@return update 된 memberVO
	 -->
	<update id="updateMember" parameterType="memberVO">
		update member set name=#{name}, addr=#{addr}, phone=#{phone},password_hint=#{passwordHint}, password_answer=#{passwordAnswer},pic_path=#{picPath} 
		where member_email=#{memberEmail}
	</update>
	
	<!-- 
		사용자의 비밀번호를 업데이트한다.
		@author 김유란
		@param memberVO 사용자 ID와 변경된 비밀번호를 담은 VO
	 -->
	<update id="updatePassword" parameterType="memberVO">
	update member set password=#{password} where member_email=#{memberEmail}
	</update>
	
	<!-- 
		회원의 직책을 DB에 insert한다.
		@author 변태섭
		@param HashMap 사용자 Email과 직책 사용
	 -->
	<insert id="registerMemberPosition" parameterType="string">
	insert into MEMBER_POSITION(member_position_no, name, member_email)
	values (member_position_no_seq.nextval,#{memberPosition},#{memberEmail})
	</insert>
	<!--
		@author 유동규
		@param memberEmail 회원인지 아닌지 판단할 이메일
		@return count(m.member_email) 0이면 회원 0이 아니면 탈퇴 
 	-->
	 <select id="isMember" resultType="int">
	 	select count(m.member_email) 
		from member m, member_position p
		where m.member_email = p.member_email and m.member_email = #{value} and p.name = '탈퇴'
	 </select>
</mapper>
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
















